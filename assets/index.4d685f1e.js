var e=Object.defineProperty,t=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,o=(t,r,n)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[r]=n;import{r as s,R as c,a}from"./vendor.2786b42d.js";const u=class{constructor(){this.Data=void 0,this.id=u.GlobalComponentId,u.GlobalComponentId+=1}create(e){return{component:this,data:e}}serialize(e){return JSON.stringify(e)}deserialize(e){return this.validate(JSON.parse(e))}};let i=u;i.GlobalComponentId=0;const l=class extends i{constructor(){super()}validate(e){if("number"==typeof e)return e;throw new Error(`Expected Number but ${e} received.`)}};let d=l;function p(){return d.INSTANCE}d.INSTANCE=new l;const y=class extends i{constructor(){super()}validate(e){if("string"==typeof e)return e;throw new Error(`Expected String but ${e} received.`)}};y.INSTANCE=new y;const f=class extends i{constructor(){super()}validate(e){if("boolean"==typeof e)return e;throw new Error(`Expected Boolean but ${e} received.`)}};f.INSTANCE=new f;class h extends i{constructor(e){super(),this.schema=e}validate(e){if("object"!=typeof e||!e)throw new Error(`Expected Array but ${e} received.`);const s={},c=((e,s)=>{for(var c in s||(s={}))r.call(s,c)&&o(e,c,s[c]);if(t)for(var c of t(s))n.call(s,c)&&o(e,c,s[c]);return e})({},this.schema);for(const t of Object.keys(e)){if(!(t in c))throw new Error(`Unexpected key ${t}`);s[t]=c[t].validate(e[t]),delete c[t]}const a=Object.keys(c);if(a.length>0)throw new Error(`Expected ${a.join(", ")}, but neither accepted.`);return s}}function m(e){return new h(e)}const v=m({x:p(),y:p()}),x=m({x:p(),y:p()});function w(e,t){return new class extends class{constructor(e){this.componentArray=e}runNow(e){for(const t of Object.values(e.resources)){const e=this.componentArray.map((e=>t.getDataFor(e)));e.every((e=>e))&&this.run(e)}}}{constructor(){super(e)}setup(){}run(e){t(...e)}dispose(){}}}function b(){return Math.min(window.innerWidth,window.innerHeight)}function E(e,t,r){return e<t?t:r<e?r:e}const g=w([v,x],((e,t)=>{e.x=E(e.x+t.x,0,b()-48),e.y=E(e.y+t.y,0,b()-48)}));function N(e,t){const r=e+-Math.sign(e)*t;return Math.sign(e)!=Math.sign(r)?0:r}const O=w([x],(e=>{e.x=N(e.x,4),e.y=N(e.y,4)})),S=w([v,x],((e,t)=>{const r=b()/2-24;t.x+=2*Math.atan((r-e.x)/4),t.y+=2*Math.atan((r-e.y)/4)}));let j=0;class I{constructor(e,t){this.id=e,this.dataArray=t}getDataFor(e){var t;return null==(t=this.dataArray.find((t=>t.component.id===e.id)))?void 0:t.data}mutate(e,t){const r=this.getDataFor(e);r&&t(r)}}class k{constructor(){this.resources={}}createEntity(e){const t=function(e){const t=j;return j+=1,new I(t,e)}(e);return this.resources[t.id]=t,t}}class C{constructor(e){this.systems=e}setup(e){for(const t of this.systems)t.setup(e)}dispatch(e){for(const t of this.systems)t.runNow(e)}}function D(){var e,t;const r=function(){const[e]=s.exports.useState(new k);return e}(),n=function(e,t){const[r]=s.exports.useState(new C(t)),[n,o]=s.exports.useState(0);return s.exports.useEffect((()=>{r.setup(e)}),[r]),{dispatch(){r.dispatch(e),o((e=>e+1))}}}(r,[g,O,S]),o=function(e,t){const[r]=s.exports.useState((()=>e.createEntity(t)));return r}(r,[v.create({x:0,y:0}),x.create({x:0,y:0})]),{keypress:a,handleKeyDown:u,handleKeyUp:i}=function(e){const t=s.exports.useRef(Object.fromEntries(Object.values(e).map((e=>[e,!1])))),r=s.exports.useCallback((r=>{const n=e[r.key];n&&(t.current[n]=!0)}),[]),n=s.exports.useCallback((r=>{const n=e[r.key];n&&(t.current[n]=!1)}),[]);return{keypress:t,handleKeyDown:r,handleKeyUp:n}}({w:"moveUp",a:"moveLeft",s:"moveDown",d:"moveRight"}),l=s.exports.useCallback(((e,t)=>{null==o||o.mutate(x,(r=>{r.x+=e,r.y+=t}))}),[o]),d=s.exports.useCallback((()=>{a.current.moveUp&&l(0,-6),a.current.moveLeft&&l(-6,0),a.current.moveDown&&l(0,6),a.current.moveRight&&l(6,0)}),[a.current,l]);var p,y,f;return p=60,y=()=>{d(),n.dispatch()},f=[n],s.exports.useEffect((()=>{const e=setInterval((()=>{y()}),1e3/p);return()=>clearInterval(e)}),f),c.createElement("div",{className:"App",tabIndex:0,onKeyDown:u,onKeyUp:i},c.createElement("div",{className:"me",style:{left:null==(e=null==o?void 0:o.getDataFor(v))?void 0:e.x,top:null==(t=null==o?void 0:o.getDataFor(v))?void 0:t.y}}))}a.render(c.createElement(c.StrictMode,null,c.createElement(D,null)),document.getElementById("root"));
