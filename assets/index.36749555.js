var e=Object.defineProperty,t=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,o=(t,n,r)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r;import{r as s,R as c,a as i}from"./vendor.2786b42d.js";class a{constructor(){this.Data=void 0,this.id=Symbol()}create(e){return{component:this,data:e}}createRef(e){return{component:this,get data(){return e.current}}}serialize(e){return JSON.stringify(e)}deserialize(e){return this.validate(JSON.parse(e))}}const u=class extends a{constructor(){super()}validate(e){if("number"==typeof e)return e;throw new Error(`Expected Number but ${e} received.`)}};let p=u;function l(){return p.INSTANCE}p.INSTANCE=new u;const d=class extends a{constructor(){super()}validate(e){if("string"==typeof e)return e;throw new Error(`Expected String but ${e} received.`)}};d.INSTANCE=new d;const y=class extends a{constructor(){super()}validate(e){if("boolean"==typeof e)return e;throw new Error(`Expected Boolean but ${e} received.`)}};let f=y;function m(){return f.INSTANCE}f.INSTANCE=new y;class h extends a{constructor(e){super(),this.schema=e}validate(e){if("object"!=typeof e||!e)throw new Error(`Expected Array but ${e} received.`);const s={},c=((e,s)=>{for(var c in s||(s={}))n.call(s,c)&&o(e,c,s[c]);if(t)for(var c of t(s))r.call(s,c)&&o(e,c,s[c]);return e})({},this.schema);for(const t of Object.keys(e)){if(!(t in c))throw new Error(`Unexpected key ${t}`);s[t]=c[t].validate(e[t]),delete c[t]}const i=Object.keys(c);if(i.length>0)throw new Error(`Expected ${i.join(", ")}, but neither accepted.`);return s}}function v(e){return new h(e)}const w=v({x:l(),y:l()}),x=v({x:l(),y:l()});function b(e,t){return new class extends class{constructor(e){this.componentArray=e}runNow(e){for(const t of Object.getOwnPropertySymbols(e.entities)){const n=e.entities[t],r=this.componentArray.map((t=>e.getEntityData(n,t)));r.every((e=>e))&&this.run(r)}}}{constructor(){super(e)}setup(){}run(e){t(...e)}dispose(){}}}function E(){return Math.min(window.innerWidth,window.innerHeight)}function g(e,t,n){return e<t?t:n<e?n:e}const N=b([w,x],((e,t)=>{e.x=g(e.x+t.x,0,E()-48),e.y=g(e.y+t.y,0,E()-48)}));function S(e,t){const n=e+-Math.sign(e)*t;return Math.sign(e)!=Math.sign(n)?0:n}const O=b([x],(e=>{e.x=S(e.x,4),e.y=S(e.y,4)})),j=b([w,x],((e,t)=>{const n=E()/2-24;t.x+=2*Math.atan((n-e.x)/4),t.y+=2*Math.atan((n-e.y)/4)}));class D{constructor(){this.id=Symbol()}}class I{constructor(){this.entities={},this.components={}}createEntity(e){const t=new D;for(const n of e)n.component.id in this.components||(this.components[n.component.id]={}),this.components[n.component.id][t.id]=n;return this.entities[t.id]=t,t}getEntityData(e,t){var n,r;return null==(r=null==(n=this.components[t.id])?void 0:n[e.id])?void 0:r.data}}class k{constructor(e){this.systems=e}setup(e){for(const t of this.systems)t.setup(e)}dispatch(e){for(const t of this.systems)t.runNow(e)}}const A=v({moveUp:m(),moveLeft:m(),moveDown:m(),moveRight:m()}),C=b([A,x],((e,t)=>{e.moveUp&&(t.y-=6),e.moveLeft&&(t.x-=6),e.moveDown&&(t.y+=6),e.moveRight&&(t.x+=6)}));function M(){const e=function(){const[e]=s.exports.useState(new I);return e}(),t=function(e,t){const[n]=s.exports.useState(new k(t)),[r,o]=s.exports.useState(0);return s.exports.useEffect((()=>{n.setup(e)}),[n]),{dispatch(){n.dispatch(e),o((e=>e+1))}}}(e,[N,O,j,C]),{keypress:n,handleKeyDown:r,handleKeyUp:o}=function(e){const t=s.exports.useRef(Object.fromEntries(Object.values(e).map((e=>[e,!1])))),n=s.exports.useCallback((n=>{const r=e[n.key];r&&(t.current[r]=!0)}),[]),r=s.exports.useCallback((n=>{const r=e[n.key];r&&(t.current[r]=!1)}),[]);return{keypress:t,handleKeyDown:n,handleKeyUp:r}}({w:"moveUp",a:"moveLeft",s:"moveDown",d:"moveRight"}),i=function(e,t){const[n]=s.exports.useState((()=>e.createEntity(t)));return n}(e,[w.create({x:0,y:0}),x.create({x:0,y:0}),A.createRef(n)]);var a,u,p;a=60,u=()=>{t.dispatch()},p=[t],s.exports.useEffect((()=>{const e=setInterval((()=>{u()}),1e3/a);return()=>clearInterval(e)}),p);const l=e.getEntityData(i,w);return c.createElement("div",{className:"App",tabIndex:0,onKeyDown:r,onKeyUp:o},c.createElement("div",{className:"me",style:{left:null==l?void 0:l.x,top:null==l?void 0:l.y}}))}i.render(c.createElement(c.StrictMode,null,c.createElement(M,null)),document.getElementById("root"));
